<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MAXIMUM REALITY: KART CIRCUIT</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
  body { margin: 0; background: #000; color: #0ff; font-family: 'Courier New', Courier, monospace; overflow: hidden; touch-action: none; text-align: center; }
  #game-container { position: relative; width: 100vw; height: 100vh; background: linear-gradient(#020a2a, #000); }
  canvas { display: block; width: 100%; height: 100%; }
  
  #ui { position: absolute; top: 10px; width: 100%; display: flex; justify-content: space-around; font-size: 18px; font-weight: bold; text-shadow: 0 0 10px #0ff; z-index: 10; }
  #controls { position: absolute; bottom: 30px; width: 100%; display: flex; justify-content: center; gap: 40px; z-index: 10; }
  .btn { width: 80px; height: 80px; background: rgba(255, 255, 255, 0.1); border: 2px solid #0ff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; color: white; user-select: none; }
  
  #overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; }
  .title { font-size: 2rem; color: #ff00ff; text-shadow: 0 0 15px #ff00ff; margin-bottom: 10px; }
  .char-select { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0; }
  .char-btn { font-size: 40px; padding: 10px; background: #111; border: 2px solid #444; border-radius: 10px; cursor: pointer; }
  .char-btn.active { border-color: #0ff; box-shadow: 0 0 10px #0ff; }
  #high-score-msg { font-size: 12px; color: #aaa; margin-top: 10px; }
</style>
</head>
<body>

<div id="game-container">
  <div id="ui">
    <div>MPH: <span id="speed">0</span></div>
    <div>SCORE: <span id="score">0</span></div>
    <div>BEST: <span id="best">0</span></div>
  </div>

  <div id="overlay">
    <div class="title">MAXIMUM <span>KART</span></div>
    <p id="status-msg">SELECT YOUR RACER</p>
    <div class="char-select">
      <div class="char-btn active" onclick="setCar('ğŸï¸', this)">ğŸï¸</div>
      <div class="char-btn" onclick="setCar('ğŸš•', this)">ğŸš•</div>
      <div class="char-btn" onclick="setCar('ğŸš“', this)">ğŸš“</div>
      <div class="char-btn" onclick="setCar('ğŸš”', this)">ğŸš”</div>
      <div class="char-btn" onclick="setCar('ğŸš–', this)">ğŸš–</div>
      <div class="char-btn" onclick="setCar('ğŸš˜', this)">ğŸš˜</div>
    </div>
    <button class="btn" style="width:150px; border-radius:10px;" onclick="startCountdown()">RACE</button>
    <div id="high-score-msg"></div>
  </div>

  <canvas id="roadCanvas"></canvas>

  <div id="controls">
    <div class="btn" id="btnLeft">â¬…ï¸</div>
    <div class="btn" id="btnRight">â¡ï¸</div>
  </div>
</div>

<script>
const canvas = document.getElementById("roadCanvas");
const ctx = canvas.getContext("2d");
let playerX = 0, speed = 0, score = 0, gameActive = false, countdown = 0;
let currentCar = 'ğŸï¸';
let roadOffset = 0;
let obstacles = [];
let bestScore = localStorage.getItem('kartHS') || 0;

document.getElementById('best').innerText = bestScore;

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

function setCar(emoji, el) {
  currentCar = emoji;
  document.querySelectorAll('.char-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
}

function startCountdown() {
  document.getElementById('overlay').style.display = 'none';
  countdown = 3;
  score = 0;
  playerX = 0;
  obstacles = [];
  
  const timer = setInterval(() => {
    countdown--;
    if (countdown <= -1) {
      clearInterval(timer);
      gameActive = true;
    }
  }, 800);
}

// Controls
let leftPressed = false, rightPressed = false;
const bLeft = document.getElementById("btnLeft");
const bRight = document.getElementById("btnRight");

bLeft.ontouchstart = (e) => { e.preventDefault(); leftPressed = true; };
bLeft.ontouchend = () => leftPressed = false;
bRight.ontouchstart = (e) => { e.preventDefault(); rightPressed = true; };
bRight.ontouchend = () => rightPressed = false;

function spawnObstacle() {
  if (Math.random() < 0.04) {
    obstacles.push({
      x: (Math.random() - 0.5) * 2.5,
      y: 0,
      type: Math.random() > 0.8 ? 'ğŸ”§' : 'ğŸš§',
      scale: 0.05
    });
  }
}

function update() {
  if (!gameActive) return;

  speed = Math.min(140, speed + 0.4);
  roadOffset += speed * 0.15;
  
  if (leftPressed) playerX -= 0.035;
  if (rightPressed) playerX += 0.035;
  
  if (Math.abs(playerX) > 0.9) crash();

  obstacles.forEach((obs, i) => {
    obs.y += speed * 0.004;
    obs.scale += 0.012;
    
    if (obs.y > 0.8 && obs.y < 1.0 && Math.abs((w * 0.5 + (obs.x * w * obs.y)) - (w * 0.5 + (playerX * w * 0.8))) < 60) {
      if (obs.type === 'ğŸš§') crash();
      if (obs.type === 'ğŸ”§') { score += 100; obstacles.splice(i, 1); }
    }
    
    if (obs.y > 1.2) {
      obstacles.splice(i, 1);
      score += 10;
    }
  });

  spawnObstacle();
  document.getElementById('speed').innerText = Math.floor(speed);
  document.getElementById('score').innerText = score;
}

function crash() {
  gameActive = false;
  speed = 0;
  
  if (score > bestScore) {
    bestScore = score;
    localStorage.setItem('kartHS', bestScore);
    document.getElementById('best').innerText = bestScore;
  }

  setTimeout(() => {
    document.getElementById('status-msg').innerText = "ADMITTED TO HOSPITAL ğŸ¥";
    document.getElementById('high-score-msg').innerText = "LAST RUN: " + score;
    document.getElementById('overlay').style.display = 'flex';
  }, 1000);
}

let w, h, horizon;
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  w = canvas.width; h = canvas.height;
  horizon = h * 0.45;

  // Sky
  ctx.fillStyle = "#020a2a";
  ctx.fillRect(0, 0, w, horizon);

  // Grass
  ctx.fillStyle = "#1a472a";
  ctx.fillRect(0, horizon, w, h - horizon);

  // Road
  ctx.fillStyle = "#333";
  ctx.beginPath();
  ctx.moveTo(w * 0.45, horizon); ctx.lineTo(w * 0.55, horizon);
  ctx.lineTo(w * 1.2, h); ctx.lineTo(w * -0.2, h);
  ctx.fill();

  // Lines
  ctx.strokeStyle = "#0ff";
  ctx.setLineDash([30, 30]);
  ctx.lineDashOffset = -roadOffset;
  ctx.lineWidth = 4;
  ctx.beginPath();
  ctx.moveTo(w * 0.5, horizon); ctx.lineTo(w * 0.5, h);
  ctx.stroke();

  // Countdown / Lights
  if (countdown >= 0) {
    const light = countdown === 2 ? 'ğŸ”´' : countdown === 1 ? 'ğŸŸ¡' : 'ğŸŸ¢';
    ctx.font = "100px serif";
    ctx.fillText(light, w/2 - 50, horizon - 50);
  }

  // Crash Animation
  if (!gameActive && countdown < 0) {
     ctx.font = "120px serif";
     ctx.fillText("ğŸš‘", w/2 - 60, h/2);
  }

  // Obstacles
  obstacles.forEach(obs => {
    const screenX = w * 0.5 + (obs.x * w * obs.y);
    const screenY = horizon + (obs.y * (h - horizon));
    ctx.font = (obs.scale * 60) + "px serif";
    ctx.fillText(obs.type, screenX - 20, screenY);
  });

  // Player
  const playerScreenX = w * 0.5 + (playerX * w * 0.8);
  ctx.font = "100px serif";
  ctx.save();
  ctx.translate(playerScreenX, h - 80);
  if (leftPressed) {
    ctx.scale(-1, 1);
    ctx.fillText(currentCar, -50, 0);
  } else if (rightPressed) {
    ctx.fillText(currentCar, -50, 0);
  } else {
    // Front view - we use theğŸš˜ as a proxy for front view or just center the emoji
    ctx.fillText(currentCar, -50, 0);
  }
  ctx.restore();

  // Trophy for New Record
  if (score > bestScore && bestScore > 0) {
    ctx.font = "40px serif";
    ctx.fillText("ğŸ† NEW RECORD!", 20, 150);
  }
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
