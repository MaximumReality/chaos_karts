<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MAXIMUM REALITY: CHAOS KARTS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
  body { margin: 0; background: #000; color: #0ff; font-family: -apple-system, sans-serif; overflow: hidden; touch-action: none; text-align: center; }
  #game-container { position: relative; width: 100vw; height: 100vh; background: #000; }
  canvas { display: block; width: 100%; height: 100%; }
  
  #ui { position: absolute; top: 15px; width: 100%; display: flex; justify-content: space-around; font-weight: 800; z-index: 10; text-shadow: 0 0 10px #0ff; }
  #controls { position: absolute; bottom: 40px; width: 100%; display: flex; justify-content: center; gap: 50px; z-index: 10; }
  .btn { width: 85px; height: 85px; background: rgba(255,255,255,0.1); border: 2px solid #0ff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 35px; color: white; }
  
  #overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; }
  .char-select { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0; }
  .char-btn { font-size: 40px; padding: 10px; background: #111; border: 2px solid #444; border-radius: 12px; }
  .char-btn.active { border-color: #ff00ff; box-shadow: 0 0 15px #ff00ff; }
</style>
</head>
<body>

<div id="game-container">
  <div id="ui">
    <div>MPH: <span id="speed">0</span></div>
    <div>SCORE: <span id="score">0</span></div>
    <div>BEST: <span id="best">0</span></div>
  </div>

  <div id="overlay">
    <h1 style="color:#ff00ff; text-shadow: 0 0 10px #ff00ff;">CHAOS KARTS</h1>
    <p>PICK YOUR UNIT</p>
    <div class="char-select">
      <div class="char-btn active" onclick="setCar('üöò','üèéÔ∏è', this)">üöò</div>
      <div class="char-btn" onclick="setCar('üöñ','üöï', this)">üöñ</div>
      <div class="char-btn" onclick="setCar('üöî','üöì', this)">üöî</div>
    </div>
    <button class="btn" style="width:160px; border-radius:15px;" onclick="startCountdown()">IGNITION</button>
  </div>

  <canvas id="roadCanvas"></canvas>

  <div id="controls">
    <div class="btn" id="btnLeft">‚¨ÖÔ∏è</div>
    <div class="btn" id="btnRight">‚û°Ô∏è</div>
  </div>
</div>

<script>
const canvas = document.getElementById("roadCanvas");
const ctx = canvas.getContext("2d");
let playerX = 0, speed = 0, score = 0, gameActive = false, countdown = -1;
let roadOffset = 0, obstacles = [], npcPasser = { active: false, x: 0, y: 0, scale: 0.1 };
let bestScore = localStorage.getItem('kartHS') || 0;
let isSlowMo = false, isSpinning = false, spinAngle = 0, powerupTimer = 0;

let frontEmoji = 'üöò', sideEmoji = 'üèéÔ∏è';

const imgAzul = new Image(); imgAzul.src = 'azul_front_kart.png';
const imgMochkil = new Image(); imgMochkil.src = 'mochkil_front_kart.png';
const imgPass = new Image(); imgPass.src = 'azul_mochkil_pass.png';

document.getElementById('best').innerText = bestScore;

function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
window.addEventListener("resize", resize); resize();

function setCar(front, side, el) {
  frontEmoji = front; sideEmoji = side;
  document.querySelectorAll('.char-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
}

function startCountdown() {
  document.getElementById('overlay').style.display = 'none';
  countdown = 3; score = 0; playerX = 0; obstacles = []; speed = 0;
  const timer = setInterval(() => {
    countdown--;
    if (countdown < 0) { clearInterval(timer); gameActive = true; }
  }, 800);
}

let leftP = false, rightP = false;
const bl = document.getElementById("btnLeft"), br = document.getElementById("btnRight");
bl.ontouchstart = (e) => { e.preventDefault(); leftP = true; }; bl.ontouchend = () => leftP = false;
br.ontouchstart = (e) => { e.preventDefault(); rightP = true; }; br.ontouchend = () => rightP = false;

function update() {
  if (!gameActive) return;
  
  let frameSpeed = isSlowMo ? 0.2 : 1;
  speed = Math.min(powerupTimer > 0 ? 250 : 150, speed + 0.5);
  roadOffset += speed * 0.2 * frameSpeed;
  
  if (leftP) playerX -= 0.04 * frameSpeed; 
  if (rightP) playerX += 0.04 * frameSpeed;
  
  if (Math.abs(playerX) > 0.95 && !isSpinning) crash();

  if (score > 0 && score % 500 === 0 && !npcPasser.active) {
    npcPasser.active = true; npcPasser.y = 0; npcPasser.x = (Math.random() - 0.5) * 2; npcPasser.scale = 0.05;
  }
  
  if (npcPasser.active) {
    npcPasser.y += speed * 0.008 * frameSpeed; npcPasser.scale += 0.015 * frameSpeed;
    if (npcPasser.y > 1.5) npcPasser.active = false;
  }

  obstacles.forEach((o, i) => {
    o.y += speed * 0.005 * frameSpeed; o.scale += 0.012 * frameSpeed;
    if (o.y > 0.8 && o.y < 1.0 && Math.abs(o.x - playerX) < 0.25) {
      if (o.type === 'üöß') {
          if (speed > 120) { isSlowMo = true; setTimeout(()=>isSlowMo=false, 1000); obstacles.splice(i,1); }
          else crash();
      }
      else if (o.type === 'üîß') { score += 100; obstacles.splice(i, 1); }
      else if (o.type === 'üçå') { isSpinning = true; speed *= 0.5; setTimeout(()=>{isSpinning=false; spinAngle=0;}, 1000); obstacles.splice(i,1); }
      else if (o.type === 'üöÄ') { powerupTimer = 200; obstacles.splice(i,1); }
      else if (o.type === 'üß®') { obstacles = obstacles.filter(x => x.type !== 'üöß'); score += 300; obstacles.splice(i,1); }
    }
    if (o.y > 1.3) { obstacles.splice(i, 1); score += 10; }
  });

  if (Math.random() < 0.05) {
    const types = ['üöß','üöß','üîß','üçå','üöÄ','üß®'];
    obstacles.push({x:(Math.random()-0.5)*2.5, y:0, type: types[Math.floor(Math.random()*6)], scale:0.05});
  }
  
  if (powerupTimer > 0) powerupTimer--;
  document.getElementById('speed').innerText = Math.floor(speed);
  document.getElementById('score').innerText = score;
}

function crash() {
  gameActive = false;
  if (score > bestScore) { localStorage.setItem('kartHS', score); bestScore = score; }
  setTimeout(() => { document.getElementById('overlay').style.display = 'flex'; }, 1500);
}

function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const w = canvas.width, h = canvas.height, hz = h * 0.45;

  ctx.fillStyle = "#050510"; ctx.fillRect(0,0,w,hz); // Sky
  ctx.fillStyle = "#0a1a0a"; ctx.fillRect(0,hz,w,h-hz); // Grass

  ctx.fillStyle = "#222"; ctx.beginPath(); // Road
  ctx.moveTo(w*0.45, hz); ctx.lineTo(w*0.55, hz); ctx.lineTo(w*1.3, h); ctx.lineTo(w*-0.3, h); ctx.fill();

  ctx.strokeStyle = powerupTimer > 0 ? "#ff00ff" : "#0ff"; 
  ctx.setLineDash([30,30]); ctx.lineDashOffset = -roadOffset;
  ctx.lineWidth = 4; ctx.beginPath(); ctx.moveTo(w*0.5, hz); ctx.lineTo(w*0.5, h); ctx.stroke();

  if (countdown >= 0) {
    ctx.drawImage(imgAzul, w*0.2, h-180, 100, 100);
    ctx.drawImage(imgMochkil, w*0.7, h-180, 100, 100);
    const light = ['üü¢','üü°','üî¥'][countdown-1] || 'üü¢';
    ctx.font = "80px serif"; ctx.fillText(light, w/2-40, hz-40);
  }

  obstacles.forEach(o => {
    const ox = w*0.5 + (o.x*w*o.y); const oy = hz + (o.y*(h-hz));
    ctx.font = (o.scale*60)+"px serif"; ctx.fillText(o.type, ox, oy);
  });

  if (npcPasser.active) {
    const nx = w*0.5 + (npcPasser.x*w*npcPasser.y); const ny = hz + (npcPasser.y*(h-hz));
    const ns = npcPasser.scale * 150; ctx.drawImage(imgPass, nx-(ns/2), ny-ns, ns, ns);
  }

  const px = w*0.5 + (playerX*w*0.8);
  ctx.save(); ctx.translate(px, h-100);
  if (isSpinning) { spinAngle += 0.4; ctx.rotate(spinAngle); }
  ctx.font = "100px serif";
  if (leftP) { ctx.scale(-1, 1); ctx.fillText(sideEmoji, -50, 0); }
  else if (rightP) { ctx.fillText(sideEmoji, -50, 0); }
  else { ctx.fillText(frontEmoji, -50, 0); }
  if (powerupTimer > 0) ctx.fillText('üî•', -40, 60);
  ctx.restore();

  if (!gameActive && countdown < 0) { ctx.font="100px serif"; ctx.fillText("üöë", w/2-50, h/2); }
  if (score > bestScore && bestScore > 0) { ctx.fillStyle="#ff0"; ctx.font="bold 24px sans-serif"; ctx.fillText("üèÜ NEW RECORD!", 20, 120); }
  if (isSlowMo) { ctx.fillStyle="rgba(0,255,255,0.2)"; ctx.fillRect(0,0,w,h); }

  requestAnimationFrame(draw);
}
draw();
</script>
</body>
</html>
